<div class="page page-dashboard" data-ng-controller="DashboardController">

    <div>
        <div class="row">
            <div class="col-lg-12">
                <h2 class="section-header">{{dashboard.title}}</h2>
            </div>
        </div>
        <md-fab-speed-dial id="main-fab" md-direction="up" class="md-scale md-fab-bottom-right">
            <md-fab-trigger>
                <md-button aria-label="menu" class="md-fab md-primary" md-visible="tooltipVisible">
                    <span class="fa fa-bars"></span>
                </md-button>
            </md-fab-trigger>
            <md-fab-actions>
                <md-button aria-label="menu" class="md-fab md-raised md-fab-sm" data-ng-click="showEmailDialog($event)">
                    <span class="fa fa-envelope-o"></span>
                </md-button>
                <md-button aria-label="menu" class="md-fab md-raised md-fab-sm" data-ng-click="showDashboardDialog($event, dashboard, false)">
                    <span class="fa fa-cog"></span>
                </md-button>
                <md-button aria-label="menu" class="md-fab md-raised md-fab-sm" data-ng-click="showDashboardDialog($event, {}, true)">
                    <span class="fa fa-plus"></span>
                </md-button>
            </md-fab-actions>
        </md-fab-speed-dial>
	    <div class="row">
	         <div class="col-lg-12">
	         	<ul class="nav nav-pills">
					<md-button data-ng-class="{'md-raised md-primary': dashboard.active == true}" data-ng-repeat="dashboard in dashboards | orderBy:'position'"
							   data-ng-click="switchDashboard(dashboard.id)">
						{{dashboard.title}}
					</md-button>
	         	</ul>
	         </div>
	    </div>
	    <br/>
		<div class="row" id="dashboard_content">
			<input type="hidden" id="dashboard_title" value="{{dashboard.title}}" />
	        <div class="col-lg-{{widget.size}}" data-ng-repeat="widget in dashboard.widgets | orderBy:'position'">
	            <div class="panel panel-default">
	                <div class="panel-heading">
	                    {{widget.title}}
	                    <i class="material-icons pull-right" data-ng-click="showDashboardWidgetDialog($event, widget, false)">apps</i>
	                </div>
	                <div align="center" class="panel-body" data-ng-class="{'graph-box' :  (widget.type == 'linechart' || widget.type == 'piechart')}">
	                     <linechart data-ng-if="widget.type == 'linechart'" data="widget.data" options="widget.model"></linechart>
	                     <div data-ng-if="widget.type == 'piechart'" class="pie-chart">
	                     	<pie-chart data="widget.data.dataset" options="widget.model"></pie-chart>
	                     </div>
	                     <div data-ng-if="widget.type == 'table'" class="table-responsive">
	                     	<table class="table table-striped table-bordered table-hover" style="width: 100%;">
	                     		<thead>
		                     		<tr>
		                     			<th class="pointer" data-ng-repeat="column in widget.model.columns" data-ng-click="changeSorting(column)">
		                     				{{column}}&nbsp;<i class="fa fa-sort"></i>
		                     			</th>
		                     		</tr>
	                     		</thead>
	                     		<tbody>
		                     		<tr data-ng-repeat="row in widget.data.dataset | orderBy:sort.column:sort.descending">
		                     			<td data-ng-repeat="column in widget.model.columns" data-ng-bind-html="asString(row[column])"></td>
		                     		</tr>
		                     		<tr class="text-center" data-ng-if="widget.data.dataset == 0">
		                     			<td colspan="{{widget.model.columns.length}}">No data</td>
		                     		</tr>
		                     	</tbody>
	                     	</table>
	                     </div>
					     <div class="table-responsive" data-ng-if="widget.type == 'sql'">
							<button type="button" class="btn btn-primary" data-ng-click="loadWidget(dashboard.title, widget, dashboard.attributes)">Run SQL query</button>
						</div>
	                </div>
	            </div>
	        </div>
		</div>
		<div class="row">
			<div class="col-lg-12">
				<button type="button" class="btn btn-primary btn-outline btn-lg btn-block" data-ng-click="showWidgetDialog($event, {model : '{}'}, true)">Create new widget</button>
			</div>
		</div>
		<div class="row">
			<div class="col-md-12">
	            <article class="article">
	                <md-card class="no-margin-h">
	                    <md-table-container>
	                        <table class="table-hover" md-table>
	                            <tbody md-body>
	                                <tr md-row ng-repeat="widget in widgets | orderBy : 'title'">
	                                    <td md-cell>{{widget.title}}</td>
	                                    <td md-cell>{{widget.type}}</td>
	                                    <td md-cell class="text-center">
	                                    	<button type="button" class="btn btn-outline btn-primary btn-xs" data-ng-click="showDashboardWidgetDialog($event, widget, true)">Add widget to dashboard</button>
	                                    </td>
                                    	<td md-cell>
	                                        <md-menu class="pull-right">
	                                            <md-button aria-label="User settings" class="md-icon-button" data-ng-click="$mdMenu.open($event);">
	                                                <md-icon class="material-icons">more_vert</md-icon>
	                                            </md-button>
	                                            <md-menu-content width="2">
	                                                <md-menu-item>
	                                                    <md-button data-ng-click="showWidgetDialog($event, widget, false)">
	                                                        <md-icon class="material-icons">settings</md-icon>
	                                                        Edit widget
	                                                    </md-button>
	                                                </md-menu-item>
	                                                <md-menu-item>
	                                                    <md-button data-ng-click="showWidgetDialog($event, widget, true)">
	                                                        <md-icon class="material-icons">content_copy</md-icon>
	                                                        Copy widget
	                                                    </md-button>
	                                                </md-menu-item>
	                                            </md-menu-content>
	                                        </md-menu>
										</td>
	                                </tr>
	                            </tbody>
	                        </table>
	                    </md-table-container>
	                </md-card>
	            </article>
	        </div>
		</div>
	</div>
</div>
